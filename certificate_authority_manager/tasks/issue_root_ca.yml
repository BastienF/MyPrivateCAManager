---

- name: init cert database
  file: path="{{ ca_manager_certificate_location }}/index.txt" state=touch

- name: init cert database serial
  shell: echo 1000 > "{{ ca_manager_certificate_location }}/serial"

- include: docker_openssl_handler.yml
  vars:
    openssl_command: >
     req -config openssl.cnf
     -key private/{{ ca_manager_key_name }} -passin pass:{{ ca_manager_key_pass }}
     -new -x509 -days 7300 -sha256 -extensions v3_ca
     -out certs/{{ ca_manager_certificate_name }}
     -subj "/C=FR/ST=IdF/L=Paris/O=CloudCustom/CN={{ ca_manager_cn_name }}"
    command_name: "RootCA - Create the root certificate"

- name: make ca cert readable
  file: path="{{ ca_manager_certificate_location }}/certs/{{ ca_manager_certificate_name }}" mode="0444"
